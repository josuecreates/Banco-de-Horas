<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Horas</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-image: url('https://conteudo.zenklub.com.br/blog/wp-content/uploads/2023/11/iStock-1188384237.jpg');
            background-size: cover;
            background-position: center;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-sizing: border-box;
        }

        .main-container {
            max-width: 90%;
        }

        .hidden {
            display: none;
        }

        h2, h3 {
            text-align: center;
            margin-bottom: 20px;
        }

        input[type="text"], input[type="password"], input[type="email"], input[type="time"], select, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }

        input[type="text"], input[type="password"], input[type="email"], input[type="time"], select {
            background: #fff;
            color: #000;
        }

        button {
            background: #28a745;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #218838;
        }

        .link {
            color: #ffc107;
            cursor: pointer;
            text-decoration: underline;
            display: block;
            text-align: center;
            margin: 10px 0;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: #fff;
            color: #000;
        }

        th, td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #333;
            color: #fff;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .chart-container {
            margin-top: 20px;
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-group input, .filter-group button {
            flex: 1;
            min-width: 150px;
        }

        .editable, .delete {
            cursor: pointer;
        }

        .paid {
            background-color: #d4edda; /* Verde claro */
        }

        .not-paid {
            background-color: #f8d7da; /* Vermelho claro */
        }

        .editable:hover, .delete:hover {
            text-decoration: underline;
        }

        #errorMessage {
            color: red;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Login -->
    <div id="loginContainer" class="container">
        <h2>Login</h2>
        <input type="text" id="loginUser" placeholder="Usuário">
        <input type="password" id="loginPassword" placeholder="Senha">
        <button onclick="login()">Entrar</button>
        <div>
            <span class="link" onclick="showRegister()">Registrar</span>
            <span class="link" onclick="showForgotPassword()">Esqueci a Senha</span>
        </div>
        <div id="errorMessage" class="hidden"></div>
    </div>

    <!-- Registro -->
    <div id="registerContainer" class="container hidden">
        <h2>Registrar</h2>
        <input type="text" id="registerUser" placeholder="Usuário">
        <input type="password" id="registerPassword" placeholder="Senha">
        <button onclick="register()">Registrar</button>
        <div>
            <span class="link" onclick="showLogin()">Voltar</span>
        </div>
    </div>

    <!-- Esqueci a Senha -->
    <div id="forgotPasswordContainer" class="container hidden">
        <h2>Esqueci a Senha</h2>
        <input type="email" id="forgotEmail" placeholder="E-mail">
        <button onclick="forgotPassword()">Enviar E-mail</button>
        <div>
            <span class="link" onclick="showLogin()">Voltar</span>
        </div>
    </div>

    <!-- Tela Principal -->
    <div id="mainContainer" class="container main-container hidden">
        <h2 id="welcomeMessage">Bem-vindo(a)!</h2>
        <div class="form-group">
            <label for="nome">Nome:</label>
            <input type="text" id="nome">
        </div>
        <div class="form-group">
            <label for="diaSemana">Dia da Semana:</label>
            <select id="diaSemana">
                <option value="segunda">Segunda-feira</option>
                <option value="terca">Terça-feira</option>
                <option value="quarta">Quarta-feira</option>
                <option value="quinta">Quinta-feira</option>
                <option value="sexta">Sexta-feira</option>
            </select>
        </div>
        <div class="form-group">
            <label for="entrada">Hora de Entrada:</label>
            <input type="time" id="entrada" value="08:00">
        </div>
        <div class="form-group">
            <label for="saida">Hora de Saída:</label>
            <input type="time" id="saida" value="14:00">
        </div>
        <div class="form-group">
            <button id="adicionarRegistro" onclick="adicionarRegistro()">Adicionar</button>
        </div>

        <div class="form-group">
            <h3>Filtrar Histórico</h3>
            <div class="filter-group">
                <input type="text" id="searchNome" placeholder="Procurar por Nome">
                <input type="text" id="searchDiaSemana" placeholder="Procurar por Dia da Semana">
                <input type="text" id="searchMes" placeholder="Procurar por Mês (Ex: 01 para Janeiro)">
            </div>
            <div class="filter-group">
                <button onclick="filtrarHistorico()">Filtrar</button>
                <button onclick="limparFiltros()">Limpar Filtros</button>
            </div>
        </div>

        <div class="table-container">
            <h2>Histórico de Registros</h2>
            <table id="historicoTabela">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Dia da Semana</th>
                        <th>Hora de Entrada</th>
                        <th>Hora de Saída</th>
                        <th>Horas Trabalhadas</th>
                        <th>Saldo de Horas</th>
                        <th>Data</th>
                        <th>Status</th>
                        <th>Ação</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <div class="chart-container">
            <h2>Horas Trabalhadas</h2>
            <canvas id="horasChart"></canvas>
        </div>

        <div class="form-group">
            <button onclick="logout()">Sair</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script>
        let registros = JSON.parse(localStorage.getItem('registros')) || [];
        let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
        let editIndex = null; // Índice do registro que está sendo editado
        let saldoAcumulado = 0;

        function showLogin() {
            $('#loginContainer').removeClass('hidden');
            $('#registerContainer').addClass('hidden');
            $('#forgotPasswordContainer').addClass('hidden');
            $('#mainContainer').addClass('hidden');
        }

        function showRegister() {
            $('#loginContainer').addClass('hidden');
            $('#registerContainer').removeClass('hidden');
            $('#forgotPasswordContainer').addClass('hidden');
            $('#mainContainer').addClass('hidden');
        }

        function showForgotPassword() {
            $('#loginContainer').addClass('hidden');
            $('#registerContainer').addClass('hidden');
            $('#forgotPasswordContainer').removeClass('hidden');
            $('#mainContainer').addClass('hidden');
        }

        function login() {
            const loginUser = $('#loginUser').val();
            const loginPassword = $('#loginPassword').val();

            const user = usuarios.find(u => u.username === loginUser && u.password === loginPassword);

            if (user) {
                $('#welcomeMessage').text(`Bem-vindo(a), ${loginUser}!`);
                $('#loginContainer').addClass('hidden');
                $('#mainContainer').removeClass('hidden');
                carregarTabela();
                atualizarGrafico();
            } else {
                $('#errorMessage').text('Usuário ou senha incorretos!').removeClass('hidden');
            }
        }

        function register() {
            const registerUser = $('#registerUser').val();
            const registerPassword = $('#registerPassword').val();

            const existingUser = usuarios.find(u => u.username === registerUser);

            if (existingUser) {
                alert('Usuário já existe!');
            } else {
                usuarios.push({ username: registerUser, password: registerPassword });
                localStorage.setItem('usuarios', JSON.stringify(usuarios));
                alert('Usuário registrado com sucesso!');
                showLogin();
            }
        }

        function forgotPassword() {
            const email = $('#forgotEmail').val();
            alert('Um e-mail de recuperação foi enviado para ' + email);
        }

        function logout() {
            $('#mainContainer').addClass('hidden');
            $('#loginContainer').removeClass('hidden');
        }

        function adicionarRegistro() {
            const nome = $('#nome').val();
            const diaSemana = $('#diaSemana').val();
            const entrada = $('#entrada').val();
            const saida = $('#saida').val();

            const [horaEntrada, minutoEntrada] = entrada.split(':').map(Number);
            const [horaSaida, minutoSaida] = saida.split(':').map(Number);

            const entradaDate = new Date();
            entradaDate.setHours(horaEntrada, minutoEntrada);

            const saidaDate = new Date();
            saidaDate.setHours(horaSaida, minutoSaida);

            let horasTrabalhadas = (saidaDate - entradaDate) / 36e5; // Horas trabalhadas

            if (horasTrabalhadas < 0) {
                horasTrabalhadas += 24; // Caso o horário de saída seja no dia seguinte
            }

            const saldoHoras = horasTrabalhadas - 6; // Considerando 6 horas de trabalho padrão (08:00 - 14:00)
            saldoAcumulado += saldoHoras; // Acumula o saldo

            const registro = {
                nome,
                diaSemana,
                entrada,
                saida,
                horasTrabalhadas: horasTrabalhadas.toFixed(2),
                saldoHoras: saldoAcumulado.toFixed(2),
                data: new Date().toLocaleDateString(),
                status: saldoAcumulado >= 0 ? 'Pago' : 'Não Pago'
            };

            if (editIndex !== null) {
                registros[editIndex] = registro;
                editIndex = null;
            } else {
                registros.push(registro);
            }

            localStorage.setItem('registros', JSON.stringify(registros));
            carregarTabela();
            atualizarGrafico();
            limparCampos();
        }

        function carregarTabela() {
            const tbody = $('#historicoTabela tbody');
            tbody.empty();

            registros.forEach((registro, index) => {
                const row = $('<tr>');

                row.append(`<td>${registro.nome}</td>`);
                row.append(`<td>${registro.diaSemana}</td>`);
                row.append(`<td>${registro.entrada}</td>`);
                row.append(`<td>${registro.saida}</td>`);
                row.append(`<td>${registro.horasTrabalhadas}</td>`);
                row.append(`<td>${registro.saldoHoras}</td>`);
                row.append(`<td>${registro.data}</td>`);
                row.append(`<td class="${registro.status === 'Pago' ? 'paid' : 'not-paid'}">${registro.status}</td>`);
                row.append(`<td><span class="editable" onclick="editarRegistro(${index})">Editar</span> | <span class="delete" onclick="deletarRegistro(${index})">Excluir</span></td>`);

                tbody.append(row);
            });
        }

        function editarRegistro(index) {
            const registro = registros[index];
            $('#nome').val(registro.nome);
            $('#diaSemana').val(registro.diaSemana);
            $('#entrada').val(registro.entrada);
            $('#saida').val(registro.saida);

            editIndex = index;
        }

        function deletarRegistro(index) {
            registros.splice(index, 1);
            localStorage.setItem('registros', JSON.stringify(registros));
            carregarTabela();
            atualizarGrafico();
        }

        function limparCampos() {
            $('#nome').val('');
            $('#diaSemana').val('segunda');
            $('#entrada').val('08:00');
            $('#saida').val('14:00');
            editIndex = null;
        }

        function filtrarHistorico() {
            const nome = $('#searchNome').val().toLowerCase();
            const diaSemana = $('#searchDiaSemana').val().toLowerCase();
            const mes = $('#searchMes').val();

            const filteredRegistros = registros.filter(registro => {
                const registroNome = registro.nome.toLowerCase();
                const registroDiaSemana = registro.diaSemana.toLowerCase();
                const registroMes = new Date(registro.data).getMonth() + 1;

                return (
                    (nome === '' || registroNome.includes(nome)) &&
                    (diaSemana === '' || registroDiaSemana.includes(diaSemana)) &&
                    (mes === '' || registroMes == mes)
                );
            });

            carregarTabela(filteredRegistros);
        }

        function limparFiltros() {
            $('#searchNome').val('');
            $('#searchDiaSemana').val('');
            $('#searchMes').val('');
            carregarTabela();
        }

        function carregarTabela(filtros = registros) {
            const tbody = $('#historicoTabela tbody');
            tbody.empty();

            filtros.forEach((registro, index) => {
                const row = $('<tr>');

                row.append(`<td>${registro.nome}</td>`);
                row.append(`<td>${registro.diaSemana}</td>`);
                row.append(`<td>${registro.entrada}</td>`);
                row.append(`<td>${registro.saida}</td>`);
                row.append(`<td>${registro.horasTrabalhadas}</td>`);
                row.append(`<td>${registro.saldoHoras}</td>`);
                row.append(`<td>${registro.data}</td>`);
                row.append(`<td class="${registro.status === 'Pago' ? 'paid' : 'not-paid'}">${registro.status}</td>`);
                row.append(`<td><span class="editable" onclick="editarRegistro(${index})">Editar</span> | <span class="delete" onclick="deletarRegistro(${index})">Excluir</span></td>`);

                tbody.append(row);
            });
        }

        function atualizarGrafico() {
            const ctx = document.getElementById('horasChart').getContext('2d');
            const labels = registros.map(registro => registro.diaSemana);
            const horasData = registros.map(registro => registro.horasTrabalhadas);

            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Horas Trabalhadas',
                        data: horasData,
                        backgroundColor: 'rgba(0, 123, 255, 0.2)',
                        borderColor: 'rgba(0, 123, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        $(document).ready(function () {
            carregarTabela();
            atualizarGrafico();
        });
    </script>
</body>
</html>